```json
{
  "date": "2020.12.10 22:00",
  "tags": ["正则"]
}
```

在平时的工作中，我们很多地方都会使用到正则，但是实际使用频率并没有那么高，因此很多时候都是去网上查一下修改修改就用了，但是过一段时间就会忘记，每次使用都得回忆理解一些元字符，其实还是比较浪费时间的，正则作为一种生命周期很长的技术，我觉得可以花一些时间去梳理一下，方便必要时候查询。


# 正则可视化工具
- https://regex101.com/ 支持各种语言的在线正则
- http://wangwl.net/  在线验证工具
- https://regexr.com/ 在线验证工具
- https://regexper.com/ 正则铁路图


# 元字符

元字符就是指那些在正则表达式中具有特殊意义的专用字符,比如```\d```。而普通字符表示的还是原来的意思，比如```d```匹配的就是文本里面的字符d。元字符是正则里面非常重要同时又是难以记忆的东西，我们对他分类理解。

辅助记忆
d 是 digit 数字
w 是 word 单词
s 是 space 空白


- 特殊字符（基础元字符）
  - ```.``` 任意字符，除换行符外
  - ```\d``` 任意数字，```\D``` 任意非数字
  - ```\w``` 任意字母数字下划线，```\W``` 任意非字母数字下划线
  - ```\s``` 任意空白符，```\S```任意非空白符。
- 空白符
  - ```\r``` 回车符
  - ```\n``` 换行符
  - ```\f``` 换页符
  - ```\t``` 制表符
  - ```\v``` 垂直制表符
  - ```\s``` 任意空白符
- 量词  （基础元字符匹配的是单个字符，如\d匹配出现过一次的数字，能匹配到多个）
  - ```*``` 0到多次
  - ```+``` 1到多次
  - ```?``` 0到1次
  - ```{m}``` 出现m次
  - ```{m,}``` 出现至少m次
  - ```{m,n}``` 出现m到n次
- 范围
  - ```|``` 或，a|b 匹配a或者b ,(多分支选择都是左边的优先)
  - ```[abcdefg]``` 多选一，括号中任意一个元素
  - ```[a-z]``` 匹配a到z之间的任意一个元素
  - ```[^abcdefg]```  取反，不能是括号中的任意一个元素 ,如[^a-z|A-Z]不能是大小写字母
- 断言 （Assertions） 边界限定
  - 待添加

提示：
1. 不同的系统在每行文本结束位置默认的“换行”会有区别，在 Windows 里是 \r\n，在 Linux 和 MacOS 中是 \n。
2. 中括号[]代表多选一，可以表示里面的任意单个字符，所有不需要管道符号“|”。另外，中括号中，我们还可以用中划线表示范围
3. 字符组和多选结构，[]是字符组，本身带有多选一属性，而多选结构可以用```(ab|cd)```表示


示例：
```(https?|ftp):\/\/``` http://或者https://或者ftp://，问号代表s有或者无
```1[3-9]\d{9}``` 匹配11位手机号，1开头紧接着3到9中的一个数，然后接着9个数字


# 量词的贪婪、非贪婪、独占模式


有如下字符串```aaabb```在正则全局(global)匹配模式下我们可以看到正则```a+```出现一次匹配，匹配上了字符串```aaabb```其中的aaa, ```+```这个正则量词元字符表示的是1到多次，也可以用```{1,}```代替，但是我们仔细理解的话，我们会发现如果单独匹配每一个a也满足```+```这个描述，如果那样的话就应该是匹配是三次，每次分别是a啊，为什么只匹配一次？？为什么要按最长的三个a来匹配？？？注意了，这里的最长其实就是所谓的贪婪模式，在正则中，所有的量词默认都是贪婪模式，而非贪婪模式会尽可能短地去匹配。

- 贪婪：尽可能多地去匹配。
- 非贪婪：尽可能短地去匹配。

再来看一个例子，加深理解。还是字符串```aaabb```，有正则```a*```，默认贪婪模式会匹配5次，这5次分别如下：

1. 0-3	aaa
2. 3-3	         //这里匹配到了空的字符串
3. 4-4		       //这里匹配到了空的字符串
4. 5-5	         //这里匹配到了空的字符串
5. 6-6		       //这里匹配到了空的字符串

量词```*``` 相当于```{0,}```,可匹配零次。其实如果是非贪婪模式的话，那是不是都会匹配0次了呢？

### 在量词后面加上英文的问号 ```?``` 就会开启非贪婪匹配（Lazy）模式。

正则```a*?```匹配如下：

1. 0-0	
2. 1-1		        
3. 2-2		      
4. 3-3	       
5. 4-4	
6. 5-5
7. 6-6	

全部匹配到了空的字符串，总共匹配7次。正则```a{1,3}```默认匹配一次，```a{1,3}?```会匹配三次。


又例如：


有html ```<div></div>```,正则```</?.*>```匹配一次，正则```</?.*?>```(非贪婪)匹配两次。

![20-12-11-re](./images/20-12-11-re.png)

涂伟忠老师的图，贪婪和非贪婪模式的区别。

### 独占模式

这个模式很少用，像GOLANG就不支持，独占模式是用来避免向前回溯的，一般是在量词前面添加一个 ```+```号，如```a{1,3}+ab```,

在正常的贪婪模式下，如果用 ```xy{1,3}z``` 去匹配 xyyz 字符串，y{1,3} 会尽量匹配字符串y,因此会向前匹配到位置3，接着字符串中后面是个 z 就会导致匹配不上，这时候正则就会向前回溯。

独占模式和贪婪模式很像，独占模式会尽可能多地去匹配，如果匹配失败就结束，不会进行回溯。

如果用 ```a{1,3}+ab``` 去匹配 aaab 字符串，```a{1,3}+``` 使用贪婪模式会把前面三个 a 都用掉，并且不会回溯，这样字符串中内容只剩下 b 了，导致正则中加号后面的 a 匹配不到符合要求的内容，匹配失败。

如果要深刻理解独占模式的话可能需要对正则的状态机有所了解。

# 分组

即添加小括号```()```,在正则中如果添加小括号有两个意义，分别是：

- 当我们需要把一部分元字符看作一个整体的时候
- 当我们需要保存一个子组(子表达式)用来复用时

1. 先来看当我们需要把一部分元字符看作一个整体的时候，需要添加```(?:)```,例如

```\d{15}(?:\d{3})? ```表示匹配15个数字后面的3个数字可有可无,如果我们不用小括号来包含```\d{3}```的话，正则就是```\d{15}\d{3}? ```表达的意思就变成了`匹配15个数字紧跟着使用非贪婪模式匹配3个数字，这里不加?:也是可以的，``` \d{15}(\d{3})? ```  也有相同的意义，只不过不加?:的小括号括起来的部分“子表达式”会被保存成一个子组，所以我们这里只是把一部分元字符看作一个整体，不需要子组的功能添加?: